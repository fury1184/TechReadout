{% extends "base.html" %}

{% block title %}Spec Lookup - TechReadout{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h3 mb-0">Hardware Spec Lookup</h1>
</div>

<!-- How It Works -->
<div class="card mb-4">
    <div class="card-header">
        <h5 class="card-title mb-0"><i class="bi bi-info-circle"></i> How Spec Lookup Works</h5>
    </div>
    <div class="card-body">
        <p>TechReadout uses <strong>on-demand lookup</strong> instead of bulk scraping. When you add an inventory item:</p>
        <ol>
            <li>Type a model name (e.g., "RTX 4070", "i7-9700K", "ROG STRIX B550-F")</li>
            <li>Click <strong>Lookup</strong> to fetch specs automatically</li>
            <li>Specs are saved to your local database and cached forever</li>
        </ol>
        <p class="mb-0">This approach is more efficient â€” you only fetch specs for parts you actually own.</p>
    </div>
</div>

<!-- Stats -->
<div class="row g-4 mb-4">
    <div class="col-md-2">
        <div class="card text-center">
            <div class="card-body">
                <h2 class="display-6 text-primary">{{ total_specs }}</h2>
                <p class="text-muted mb-0">Cached Specs</p>
            </div>
        </div>
    </div>
    <div class="col-md-2">
        <div class="card text-center">
            <div class="card-body">
                <h2 class="display-6 text-success">{{ cpu_count }}</h2>
                <p class="text-muted mb-0">CPUs</p>
            </div>
        </div>
    </div>
    <div class="col-md-2">
        <div class="card text-center">
            <div class="card-body">
                <h2 class="display-6 text-info">{{ gpu_count }}</h2>
                <p class="text-muted mb-0">GPUs</p>
            </div>
        </div>
    </div>
    <div class="col-md-2">
        <div class="card text-center">
            <div class="card-body">
                <h2 class="display-6 text-warning">{{ mobo_count }}</h2>
                <p class="text-muted mb-0">Motherboards</p>
            </div>
        </div>
    </div>
    <div class="col-md-2">
        <div class="card text-center">
            <div class="card-body">
                <h2 class="display-6 text-danger">{{ psu_count }}</h2>
                <p class="text-muted mb-0">PSUs</p>
            </div>
        </div>
    </div>
</div>

<!-- Data Sources -->
<div class="card mb-4">
    <div class="card-header bg-primary text-white">
        <h5 class="card-title mb-0"><i class="bi bi-globe"></i> Data Sources</h5>
    </div>
    <div class="card-body">
        <div class="row g-3">
            <div class="col-md-3">
                <h6><i class="bi bi-cpu text-success"></i> CPUs</h6>
                <p class="small text-muted mb-1">Intel ARK + TechPowerUp</p>
                <ul class="small mb-0">
                    <li>Cores, Threads</li>
                    <li>Base & Boost Clock</li>
                    <li>TDP, Socket</li>
                </ul>
            </div>
            <div class="col-md-3">
                <h6><i class="bi bi-gpu-card text-info"></i> GPUs</h6>
                <p class="small text-muted mb-1">TechPowerUp + Manufacturer Sites</p>
                <ul class="small mb-0">
                    <li>VRAM Size & Type</li>
                    <li>Base & Boost Clock</li>
                    <li>TDP</li>
                </ul>
            </div>
            <div class="col-md-3">
                <h6><i class="bi bi-motherboard text-warning"></i> Motherboards</h6>
                <p class="small text-muted mb-1">Amazon + Manufacturer Sites</p>
                <ul class="small mb-0">
                    <li>Socket, Chipset</li>
                    <li>Form Factor</li>
                    <li>Memory, PCIe, M.2</li>
                </ul>
            </div>
            <div class="col-md-3">
                <h6><i class="bi bi-lightning-charge text-danger"></i> PSUs</h6>
                <p class="small text-muted mb-1">Amazon</p>
                <ul class="small mb-0">
                    <li>Wattage</li>
                    <li>Efficiency (80+)</li>
                    <li>Modular Type</li>
                </ul>
            </div>
        </div>
        <hr>
        <div class="row g-3">
            <div class="col-md-3">
                <h6><i class="bi bi-memory text-primary"></i> RAM</h6>
                <p class="small text-muted mb-0">Amazon</p>
            </div>
            <div class="col-md-3">
                <h6><i class="bi bi-device-ssd text-secondary"></i> Storage</h6>
                <p class="small text-muted mb-0">Amazon</p>
            </div>
            <div class="col-md-3">
                <h6><i class="bi bi-fan text-info"></i> Coolers & Fans</h6>
                <p class="small text-muted mb-0">Amazon</p>
            </div>
            <div class="col-md-3">
                <h6><i class="bi bi-pc-display text-dark"></i> Cases</h6>
                <p class="small text-muted mb-0">Amazon</p>
            </div>
        </div>
        <hr>
        <p class="small text-muted mb-1">
            <strong>GPU manufacturers:</strong> XFX, ASUS, MSI, Gigabyte, EVGA, Sapphire, PowerColor, Zotac, PNY
        </p>
        <p class="small text-muted mb-0">
            <strong>Motherboard manufacturers:</strong> ASUS, MSI, Gigabyte, ASRock, EVGA
        </p>
    </div>
</div>

<!-- API Status -->
<div class="card mb-4">
    <div class="card-header">
        <h5 class="card-title mb-0"><i class="bi bi-key"></i> Scrape.Do API Status</h5>
    </div>
    <div class="card-body">
        {% if scrapedo_configured %}
        <div class="alert alert-success">
            <i class="bi bi-check-circle"></i> <strong>Configured</strong> â€” Spec lookup is enabled.
        </div>
        <div class="row">
            <div class="col-md-6">
                <h6>Credit Balance</h6>
                <div id="creditBalance">
                    <button class="btn btn-outline-primary btn-sm" onclick="checkCredits()">
                        <i class="bi bi-arrow-clockwise"></i> Check Balance
                    </button>
                </div>
            </div>
            <div class="col-md-6">
                <h6>Manage Credits</h6>
                <a href="https://scrape.do/dashboard" target="_blank" class="btn btn-outline-secondary btn-sm">
                    <i class="bi bi-box-arrow-up-right"></i> Scrape.Do Dashboard
                </a>
            </div>
        </div>
        {% else %}
        <div class="alert alert-warning mb-0">
            <i class="bi bi-exclamation-triangle"></i> <strong>Not Configured</strong> â€” Spec lookup is disabled.
            <br><small>Set <code>SCRAPEDO_TOKEN</code> in your <code>.env</code> file. See README for setup instructions.</small>
        </div>
        {% endif %}
    </div>
</div>

<!-- Credit Usage Estimates -->
<div class="card mb-4">
    <div class="card-header bg-success bg-opacity-25">
        <h5 class="card-title mb-0"><i class="bi bi-piggy-bank"></i> Lookup Methods & Credit Usage</h5>
    </div>
    <div class="card-body">
        <p class="text-muted small">Lookups try FREE methods first, then fall back to Scrape.Do API as last resort:</p>
        
        <h6 class="mt-3"><i class="bi bi-check-circle text-success"></i> FREE Methods (No Credits)</h6>
        <table class="table table-sm">
            <thead>
                <tr>
                    <th>Method</th>
                    <th>Speed</th>
                    <th>Best For</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>1. BeautifulSoup</strong></td>
                    <td class="text-success">~1-2 seconds</td>
                    <td>CPUs/GPUs on TechPowerUp</td>
                </tr>
                <tr>
                    <td><strong>2. Playwright TechPowerUp</strong></td>
                    <td class="text-warning">~10-15 seconds</td>
                    <td>CPUs/GPUs with JS anti-bot</td>
                </tr>
                <tr>
                    <td><strong>3. Playwright Amazon</strong></td>
                    <td class="text-warning">~15-20 seconds</td>
                    <td>Motherboards, PSUs, RAM, Storage</td>
                </tr>
                <tr>
                    <td><strong>4. Playwright Intel ARK</strong></td>
                    <td class="text-warning">~15-20 seconds</td>
                    <td>Server Xeons (checkbox enabled)</td>
                </tr>
            </tbody>
        </table>
        
        <h6 class="mt-3"><i class="bi bi-credit-card text-danger"></i> Paid Methods (Last Resort)</h6>
        <table class="table table-sm">
            <thead>
                <tr>
                    <th>Method</th>
                    <th>Credits</th>
                    <th>When Used</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Scrape.Do</strong></td>
                    <td>~1-4</td>
                    <td>Only if ALL free methods fail</td>
                </tr>
            </tbody>
        </table>
        
        <div class="alert alert-success small mb-0 mt-3">
            <strong>ðŸ’¡ All lookups are now FREE!</strong> Playwright handles Amazon, TechPowerUp, and Intel ARK without API credits.
            Use <strong>Import Specs</strong> page for bulk imports with AI-generated JSON.
        </div>
    </div>
</div>

<div class="text-center mt-4">
    <a href="{{ url_for('main.inventory_add') }}" class="btn btn-primary btn-lg">
        <i class="bi bi-plus-lg"></i> Add Inventory Item
    </a>
</div>

<script>
async function checkCredits() {
    const div = document.getElementById('creditBalance');
    div.innerHTML = '<span class="spinner-border spinner-border-sm"></span> Checking...';
    
    try {
        const response = await fetch('/api/credits');
        const data = await response.json();
        
        if (data.error) {
            div.innerHTML = `<span class="text-danger"><i class="bi bi-x-circle"></i> ${data.error}</span>`;
        } else if (data.remaining !== undefined) {
            const color = data.remaining < 100 ? 'danger' : data.remaining < 500 ? 'warning' : 'success';
            div.innerHTML = `
                <span class="badge bg-${color} fs-5">${data.remaining.toLocaleString()}</span>
                <span class="text-muted">credits remaining</span>
                <br><small class="text-muted">Resets: ${data.reset_date || 'Monthly'}</small>
            `;
        } else {
            div.innerHTML = '<span class="text-warning">Could not retrieve balance</span>';
        }
    } catch (e) {
        div.innerHTML = '<span class="text-danger">Error checking balance</span>';
    }
}
</script>
{% endblock %}
